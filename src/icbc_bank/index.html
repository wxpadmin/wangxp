<!DOCTYPE html>
<html data-use-rem="750">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>爱享流量</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta content="telephone=yes" name="format-detection">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">

  </head>
  <body>
    <div id="app">

    </div>

  </body>
  <script type="text/javascript" src="https://cdn.staticfile.org/zepto/1.0rc1/zepto.min.js"></script>
  <script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
  <script>
      //初始化微信分享
      wx_init()
      //判断是否在微信内部浏览器
      function isWeiXin() {
          var ua = window.navigator.userAgent.toLowerCase();
          if (ua.match(/MicroMessenger/i) == 'micromessenger') {
              return true;
          } else {
              return false;
          }
      }
      function wx_init() {
          var res = isWeiXin()
          if(res){
              var shareUrl = window.location.href.replace(/#.*$/,"");
              var batch_num = window.location.href.match(/[^/]*$/,'');
              $.ajax({
                  url: "/api/wx/jsapi/signature?url="+encodeURIComponent(shareUrl),
                  type: "get",
                  dataType:"json",
                  success: function (result) {
                      result = result.data;
                      wx.config({
                          debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                          appId: result.appid, // 必填，公众号的唯一标识
                          timestamp: result.timestamp, // 必填，生成签名的时间戳
                          nonceStr: result.noncestr, // 必填，生成签名的随机串
                          signature: result.signature,// 必填，签名，见附录1
                          jsApiList: ['onMenuShareTimeline','onMenuShareAppMessage'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
                      });
                  },
                  error: function (XMLHttpRequest, textStatus, errorThrown) {
                      console.log(textStatus);
                  }
              });
              wx.ready(function(){
                  var option =  {
                      title: '我在工商银行免费获得188M流量-全国三网通用', // 分享标题 主标题:我在工商银行免费获得388M全国、三网流量
                      desc: "60万G免费流量，等你来拿！", // 分享描述  副标题: 60万G免费流量，等你来拿
                      link: location.protocol + "//"+location.host+"/api/icbc/redirect",
                      imgUrl: "https://img.ruwe.cn/group1/M00/01/6A/ChmdplmvVrKAMZhBAAAUmMsl6hw743.jpg", // 分享图标
                      success: function () {// 用户确认分享后执行的回调函数
                          //alert('分享成功')
                      },
                      cancel: function () {// 用户取消分享后执行的回调函
                          //alert('分享失败')
                      }
                  };
                  var option2 =  {
                      title: '我在工商银行免费获得188M流量-全国三网通用', // 分享标题 主标题:我在工商银行免费获得388M全国、三网流量
                      desc: "60万G免费流量，等你来拿！", // 分享描述  副标题: 60万G免费流量，等你来拿
                      link: location.protocol + "//"+location.host+"/api/icbc/redirect",
                      imgUrl: "https://img.ruwe.cn/group1/M00/01/6A/ChmdplmvVrKAMZhBAAAUmMsl6hw743.jpg", // 分享图标
                      success: function () {// 用户确认分享后执行的回调函数
                          //alert('分享成功')

                      },
                      cancel: function () {// 用户取消分享后执行的回调函
                          //alert('分享失败')
                      }
                  };
                  wx.index_init_status = true;
                  //分享朋友圈
                  wx.onMenuShareTimeline(option);
                  //分享好友
                  wx.onMenuShareAppMessage(option2);

              });
              wx.error(function(res){
                  // alert("error:"+JSON.stringify(res));
                  console.log('error:'+JSON.stringify(res));
              });
          }

      }
      var hybrid_app ={};
      var ua = navigator.userAgent;

      //判断是否是融e联 ios
      hybrid_app.isRELIphone = function () {
          if (ua.indexOf('ICBCiPhoneBS')>-1) {
              return true;
          }
          return false;
      };
      //  判断是否是融e联 android
      hybrid_app.isRELAndroid = function () {
          if (ua.indexOf('ICBCAndroidBS')>-1 ) {
              return true;
          }
          return false;
      };
      /**
       * 检测当前浏览器是否为Android(Chrome)
       */
      console.log("用户代理: " + navigator.userAgent);
      hybrid_app.isAndroid = function() {
          if (ua.indexOf('Android')>-1) {
              return true;
          }
          return false;
      };
      /**
       * 检测当前浏览器是否为iPhone(Safari)
       */
      hybrid_app.isIPhone = function() {
          if (ua.indexOf('iPhone')>-1) {
              return true;
          }
          return false;
      };


      function connectWebViewJavascriptBridge(callback) {
          try {
              if (window.WebViewJavascriptBridge) {
                  return callback(window.WebViewJavascriptBridge);
              } else {
                  document.addEventListener('WebViewJavascriptBridgeReady', function () {
                      callback(window.WebViewJavascriptBridge);
                  }, false);
              }
              if (window.WVJBCallbacks) {
                  return window.WVJBCallbacks.push(callback);
              }
              window.WVJBCallbacks = [callback];
              var WVJBIframe = document.createElement('iframe');
              WVJBIframe.style.display = 'none';
              WVJBIframe.src = 'wvjbscheme://__BRIDGE_LOADED__';
              document.documentElement.appendChild(WVJBIframe);
              setTimeout(function () {
                  document.documentElement.removeChild(WVJBIframe)
              });
          }catch(e){
              //alert(e);
          }
      }
      connectWebViewJavascriptBridge(function(bridge) {
          if(bridge==null) return;
          bridge.init && bridge.init();
          bridge.registerHandler && bridge.registerHandler("callback",callback);
      });

      var ICBCBridge = {
          callHandler: function(name, params, callback) {
              connectWebViewJavascriptBridge(function(bridge) {
                  bridge.callHandler(name, params, callback);
              });
          },
          send: function(params, callback) {
              connectWebViewJavascriptBridge(function(bridge) {
                  bridge.send(params, callback);
              });
          }
      };
      window.ICBCBridge = ICBCBridge;

      //中途登录
      hybrid_app.merLogin = function(){
          //如果是安卓
          if(hybrid_app.isAndroid()){
              Myutils.open("callLogin");
          }else{  //ios
              window.ICBCBridge.callHandler("Myutils.open","callLogin")
          }

      }
      //第三方显示或隐藏tabbar isShow:true显示tabbar 反之隐藏
      hybrid_app.showToolBar = function(isShow){
          //如果是安卓
          if(hybrid_app.isAndroid()){
              Myutils.showToolBar(isShow);
          }else{  //ios
              window.ICBCBridge.callHandler("Myutils.showToolBar",isShow)
          }
      }

      //第三方返回上一级页面
      hybrid_app.back = function(){
          //如果是安卓
          if(hybrid_app.isAndroid()){
              Myutils.back();
          }else{  //ios
              window.ICBCBridge.callHandler("Myutils.back")
          }
      }
      //第三方开启定位
      hybrid_app.openGPS = function(){
          //如果是安卓
          if(hybrid_app.isAndroid()){
              Myutils.openGPS();
          }else{  //ios
              window.ICBCBridge.callHandler("Myutils.openGPS")
          }
      }
      //第三方关闭定位
      hybrid_app.closeGPS = function(){
          //如果是安卓
          if(hybrid_app.isAndroid()){
              Myutils.closeGPS();
          }else{  //ios
              window.ICBCBridge.callHandler("Myutils.closeGPS")
          }
      }

      //第三方获取定位  参数是回调的函数名的字符串
      hybrid_app.getMyLocation = function(getGps){
          //如果是安卓
          if(hybrid_app.isAndroid()){
              Myutils.getMyLocation(getGps);
          }else{  //ios
              window.ICBCBridge.callHandler("Myutils.getMyLocation",getGps)
          }
      }


      //第三方打电话功能  参数是电话号
      hybrid_app.callPhoneNumber = function(tel){
          //如果是安卓
          if(hybrid_app.isAndroid()){
              Myutils.callPhoneNumber(tel);
          }else{  //ios
              window.ICBCBridge.callHandler("Myutils.callPhoneNumber",tel)
          }
      }

      //中途登录的回调
      function callLogin(param){

      }

      //获取定位信息的回调
      function getGps(param) {

      }

      function shareRed(info) {
          /******************** demo ********************
           调用分享交互需要传入的参数如下
           ******************** demoend ******************/
              //pngUrl：分享后链接显示的图片地址
          var pngUrl = 'http://img.ruwe.cn/group1/M00/01/66/ChmdpllxZeOAO1mkAAAkqTYMnEI691.jpg';
          //shareUrl：分享后点击链接需要跳转的地址
          // var shareUrl = 'http://'+window.location.host+'/icbc_bank/index.html#/redopen?id='+info.order_id;
          var shareUrl = 'http://'+window.location.host+'/api/icbc/redirect?redirect_url='+encodeURIComponent('/icbc_bank/index.html#/redopen?id='+info.order_id);
          var title = '我在工商银行免费获得'+info.amount+'M流量-全国三网通用';

          //content：分享后链接显示的内容o
          var content = '60万G免费流量，等你来拿';
          //封装需要分享的对象
          var shareInfo = {
              PNGUrl: pngUrl,
              ShareUrl: shareUrl,
              Title: title,
              Content: content
          };
          // 将对象转为字符串
          shareInfo = JSON.stringify(shareInfo);
          //alert(shareInfo)
          var _jumpUtil = new jumpUtil();
          _jumpUtil.share(shareInfo);
      }

      function shareRedeem(info) {
          /******************** demo ********************
           调用分享交互需要传入的参数如下
           ******************** demoend ******************/
              //pngUrl：分享后链接显示的图片地址
          var pngUrl = 'http://img.ruwe.cn/group1/M00/01/66/ChmdpllxZeOAO1mkAAAkqTYMnEI691.jpg';

          //shareUrl：分享后点击链接需要跳转的地址
          var shareUrl = 'http://'+window.location.host+'/icbc_bank/index.html#/share';
          //var shareUrl = 'http://'+window.location.host+'/api/icbc/redirect?redirect_url='+encodeURIComponent('/icbc_coupon/index.html#/');
          //title：分享后链接显示的标题
          var title = '我在工商银行免费获得'+info+'M流量-全国三网通用';

          //content：分享后链接显示的内容o
          var content = '60万G免费流量，等你来拿';


          //封装需要分享的对象
          var shareInfo = {
              PNGUrl: pngUrl,
              ShareUrl: shareUrl,
              Title: title,
              Content: content
          };

          // 将对象转为字符串
          shareInfo = JSON.stringify(shareInfo);
          //alert(shareInfo)

          var _jumpUtil = new jumpUtil();
          _jumpUtil.share(shareInfo);

      }

      function shareCode(info) {
          /******************** demo ********************
           调用分享交互需要传入的参数如下
           ******************** demoend ******************/
              //pngUrl：分享后链接显示的图片地址
          var pngUrl = 'https://img.ruwe.cn/group1/M00/01/6A/ChmdplmvVrKAMZhBAAAUmMsl6hw743.jpg';

          //shareUrl：分享后点击链接需要跳转的地址
          var shareUrl = 'http://'+window.location.host+'/api/icbc/redirect?redirect_url='+encodeURIComponent('/icbc_bank/index.html#/redopen?id='+info.order_id);


          //title：分享后链接显示的标题
          var title = '我在工商银行免费获得'+info+'M流量-全国三网通用';

          //content：分享后链接显示的内容o
          var content = '60万G免费流量，等你来拿';

          //封装需要分享的对象
          var shareInfo = {
              PNGUrl: pngUrl,
              ShareUrl: shareUrl,
              Title: title,
              Content: content
          };

          // 将对象转为字符串
          shareInfo = JSON.stringify(shareInfo);
          //alert(shareInfo)

          var _jumpUtil = new jumpUtil();
          _jumpUtil.share(shareInfo);

      }





      function shareCode(info) {
          /******************** demo ********************
           调用分享交互需要传入的参数如下
           ******************** demoend ******************/
              //pngUrl：分享后链接显示的图片地址
          var pngUrl = 'https://img.ruwe.cn/group1/M00/01/6A/ChmdplmvVrKAMZhBAAAUmMsl6hw743.jpg';

          //shareUrl：分享后点击链接需要跳转的地址
          var shareUrl = 'http://'+window.location.host+'/api/icbc/redirect?redirect_url='+encodeURIComponent('/icbc_bank/index.html#/redopen?id='+info.order_id);


          //title：分享后链接显示的标题
          var title = '我在工商银行免费获得'+info+'M流量-全国三网通用';

          //content：分享后链接显示的内容o
          var content = '60万G免费流量，等你来拿';

          //封装需要分享的对象
          var shareInfo = {
              PNGUrl: pngUrl,
              ShareUrl: shareUrl,
              Title: title,
              Content: content
          };

          // 将对象转为字符串
          shareInfo = JSON.stringify(shareInfo);
          //alert(shareInfo)

          var _jumpUtil = new jumpUtil();
          _jumpUtil.share(shareInfo);

      }


      function jumpUtil(){};

      jumpUtil.prototype = {
          // 跳转申请办卡页
          ApplicationCard : function(url) {
              if (ICBCUtilTools.isAndroid()) {
                  window.Myutils.ApplicationCard(url);
              }
              if (ICBCUtilTools.isiPhone()) {
                  window.WebViewJavascriptBridge.callHandler(
                      'Myutils.ApplicationCard', url);
              }
          },
          // 跳转用卡页原子服务
          UseCard : function(menuId) {
              if (ICBCUtilTools.isAndroid()) {
                  window.Myutils.UseCard(menuId);
              }
              if (ICBCUtilTools.isiPhone()) {
                  window.WebViewJavascriptBridge.callHandler('Myutils.UseCard',
                      menuId);
              }
          }, // 调用端上推广有礼注册方法(呼起页面)
          openExtendQrCode : function() {
              // 如果是e生活，融e联安卓
              if (ICBCUtil.isAndroid()) {
                  Myutils.openExtendQrCode();
              } else if (ICBCUtil.isiPhone()) { // 如果是e生活，融e联ios
                  WebViewJavascriptBridge.callHandler("Myutils.openExtendQrCode")
              }
          },

          //关闭webview
          colseView : function() {
              if (ICBCUtilTools.isAndroid()) {
                  window.Myutils.colseView(menuId);
              }
              if (ICBCUtilTools.isiPhone()) {
                  window.WebViewJavascriptBridge.callHandler('Myutils.colseView');
              }
          },

          //分享
          share: function (shareInfo) {
              if (hybrid_app.isAndroid()) {
                  //alert('Android');
                  //alert(window.Myutils);
                  window.Myutils.share(shareInfo);

              }else if(hybrid_app.isIPhone()){
                  //（ios需要将参数base64加密）
                  //alert('IPhone');
                  WebViewJavascriptBridge.callHandler("Myutils.share", base64Encode(shareInfo));
              }
          }

      };

      //base64转码（由于ios客户端对特殊字符拦截，故要转码后传值）
      function base64Encode(str) {
          _utf8_encode = function (string) {
              string = string.replace(/\r\n/g, "\n");
              var utftext = "";
              for (var n = 0; n < string.length; n++) {
                  var c = string.charCodeAt(n);
                  if (c < 128) {
                      utftext += String.fromCharCode(c);
                  } else if ((c > 127) && (c < 2048)) {
                      utftext += String.fromCharCode((c >> 6) | 192);
                      utftext += String.fromCharCode((c & 63) | 128);
                  } else {
                      utftext += String.fromCharCode((c >> 12) | 224);
                      utftext += String.fromCharCode(((c >> 6) & 63) | 128);
                      utftext += String.fromCharCode((c & 63) | 128);
                  }
              }
              return utftext;
          };

          _keyStr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
          var output = "";
          var chr1, chr2, chr3, enc1, enc2, enc3, enc4;
          var i = 0;
          str = _utf8_encode(str);
          while (i < str.length) {
              chr1 = str.charCodeAt(i++);
              chr2 = str.charCodeAt(i++);
              chr3 = str.charCodeAt(i++);
              enc1 = chr1 >> 2;
              enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
              enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
              enc4 = chr3 & 63;
              if (isNaN(chr2)) {
                  enc3 = enc4 = 64;
              } else if (isNaN(chr3)) {
                  enc4 = 64;
              }
              output = output +
                  _keyStr.charAt(enc1) + _keyStr.charAt(enc2) +
                  _keyStr.charAt(enc3) + _keyStr.charAt(enc4);
          }
          return output;
      }
  </script>
</html>
